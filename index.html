<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gift Games Order</title>
  <link rel="stylesheet" href="css/styles.css">
  <script src="js/generateJsonFile.js"></script>
</head>
<body>
  <div class="photo-editor">
    <!-- Step 1: Game Selection -->
    <div class="order-form">
      <h1 id="step1Title">1. Selected Game</h1>
      <p>‚ö†Ô∏è Select the game you want to customize from the menu below.</p>
      <div class="game-menu" id="gameMenu"></div>
      <input type="hidden" id="gameSelect" value="">
      <div class="notification" id="notification"></div>
    </div>

    <!-- Step 2: Player Photo -->
    <div class="order-form">
      <h1 id="step2Title">2. Player Photo</h1>
      <p>‚ö†Ô∏è Select a photo of the person you want to customize the game for. Adjust the photo to fit the face contour below.</p>
      <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="updateStep2Status(); previewPhoto()">
      <div class="canvas-container" style="position: relative; width: 380px; height: 380px;">
        <canvas id="photoCanvas"></canvas>
        <img id="overlayImage" src="./Resources/no-selected-gm-default-img.png" alt="Overlay" />
      </div>
      <div class="hidden" id="editToolsMessage">
        <p>‚ö†Ô∏è Use the tools to edit your photo.</p>
      </div>
      <div class="controls hidden" id="controlsPanel">
        <button title="Rotate Left" onclick="rotateImage(-10)">‚ü≤</button>
        <button title="Rotate Right" onclick="rotateImage(10)">‚ü≥</button>
        <button title="Zoom In" onclick="zoomImage(1.1)">üîç+</button>
        <button title="Zoom Out" onclick="zoomImage(0.9)">üîç-</button>
        <button title="Flip Photo" onclick="flipPhoto()">‚áã</button>
        <button title="Reset" onclick="resetTransformations()">‚Ü∫</button>
        <button title="Add Image" type="button" onclick="document.getElementById('photoInput').click()">‚ûï</button>
      </div>
    </div>

    <!-- Step 3: Player Details -->
    <div class="order-form">
      <h1 id="step3Title">3. Player Details</h1>
      <p>‚ö†Ô∏è Enter the name and email address of the person for whom the game is being customized.</p>
      <input type="text" id="name" placeholder="Name" required oninput="updateStep3Status(false)">
      <input type="email" id="email" placeholder="Email" required oninput="validateEmail()">
      <div id="emailError" style="color: red; font-size: 14px; display: none;">Invalid email format</div>
    </div>

    <!-- Step 4: Payment Details -->
    <div class="order-form">
<<<<<<< HEAD
      <h1 id="step4Title">4. Player Messages</h1>
      <p>‚ö†Ô∏è Toggle and enter custom messages for the player. Each message can have a maximum of 50 characters.</p>
      
      <!-- Start Message -->
      <div class="message-toggle">
        <label>
          <input type="checkbox" id="toggleStartMessage" onchange="toggleMessageInput('startMessage')">
          Enable Start Message
        </label>
        <input type="text" id="startMessage" placeholder="Start Message (max 50 chars)" maxlength="50" disabled oninput="updateStep4Status()">
      </div>

      <!-- Secondary Messages -->
      <div id="secondaryMessagesContainer">
        <div class="message-toggle">
          <label>
            <input type="checkbox" id="toggleSecondaryMessagesContainer" onchange="toggleMessageInput('secondaryMessagesContainer')">
            Enable Secondary Messages
          </label>
          <div class="secondary-message">
            <button type="button" id="addSecondaryMessageButton" onclick="addSecondaryMessage()" disabled>‚ûï Add Secondary Message</button>
            <input type="text" class="secondaryMessage" placeholder="Secondary Message (max 50 chars)" maxlength="50" disabled oninput="updateStep4Status()">
            <button type="button" class="removeSecondaryMessage" onclick="removeSecondaryMessage(this)" disabled>‚ùå</button>
          </div>
        </div>
      </div>

      <!-- Finish Message -->
      <div class="message-toggle">
        <label>
          <input type="checkbox" id="toggleFinishMessage" onchange="toggleMessageInput('finishMessage')">
          Enable Finish Message
        </label>
        <input type="text" id="finishMessage" placeholder="Finish Message (max 50 chars)" maxlength="50" disabled oninput="updateStep4Status()">
      </div>
    </div>

    <!-- Step 5: Payment Details -->
    <div class="order-form">
      <h1 id="step5Title">5. Payment Details</h1>
=======
      <h1 id="step4Title">4. Payment Details</h1>
>>>>>>> parent of 243f2d9 (added custom messages)
      <p>‚ö†Ô∏è Review the total price and place your order to complete the customization process.</p>
      <div class="order-summary">
        <h1>Payment</h1>
        <div class="summary-details">
          <p><strong>Total Price:</strong> <span id="totalPrice">20.00$</span></p>
        </div>
        <button class="payment-button" id="placeOrderButton" type="button" onclick="placeOrder()" disabled>Place Order</button>
      </div>
    </div>
  </div>

  <!-- Popup Notification -->
  <div id="popup" class="popup" style="display: none;">
    <div class="popup-content">
      <p>Your order has been placed successfully! üéâ</p>
      <button onclick="closePopup()">OK</button>
    </div>
  </div>

  <script src="js/scripts.js"></script>
  <script>
    const games = [
      { id: 'G1', name: 'Game 1 (G1)', icon: 'Resources/G1.png', overlayImage: 'Resources/avatar-mask-G1.png' },
      { id: 'G2', name: 'Game 2 (G2)', icon: 'Resources/G2.png', overlayImage: 'Resources/avatar-mask-G2.png' },
      { id: 'G3', name: 'Game 3 (G3)', icon: 'Resources/G3.png', overlayImage: 'Resources/avatar-mask-G3.png' },
      { id: 'G4', name: 'Game 4 (G4)', icon: 'Resources/G4.png', overlayImage: 'Resources/avatar-mask-G4.png' }
    ];

    function renderGameMenu() {
      const gameMenu = document.getElementById('gameMenu');
      gameMenu.innerHTML = ''; // Clear existing content

      games.forEach(game => {
        const gameOption = document.createElement('div');
        gameOption.className = 'game-option';
        gameOption.id = `game${game.id}`;
        gameOption.onclick = () => selectGame(game.id, gameOption.id);

        const gameIcon = document.createElement('img');
        gameIcon.src = game.icon;
        gameIcon.alt = `${game.name} Icon`;

        const gameName = document.createElement('span');
        gameName.textContent = game.name;

        gameOption.appendChild(gameIcon);
        gameOption.appendChild(gameName);
        gameMenu.appendChild(gameOption);
      });
    }

    function validateEmail() {
      const emailInput = document.getElementById('email');
      const emailError = document.getElementById('emailError');
      const emailPattern = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;

      if (emailInput.value && !emailPattern.test(emailInput.value)) {
        emailError.style.display = 'block';
        updateStep3Status(false); // Mark step 3 as incomplete
      } else {
        emailError.style.display = 'none';
        updateStep3Status(true); // Mark step 3 as complete
      }
      checkAllStepsCompleted();
    }

    function updateStep1Status() {
      const gameSelect = document.getElementById('gameSelect');
      const step1Title = document.getElementById('step1Title');
      if (gameSelect.value) {
        step1Title.textContent = '1. ‚úÖ Selected Game';
      } else {
        step1Title.textContent = '1. Selected Game';
      }
      checkAllStepsCompleted();
    }

    function updateStep2Status() {
      const photoInput = document.getElementById('photoInput');
      const step2Title = document.getElementById('step2Title');
      if (photoInput.files.length > 0) {
        step2Title.textContent = '2. ‚úÖ Player Photo';
      } else {
        step2Title.textContent = '2. Player Photo';
      }
      checkAllStepsCompleted();
    }

    function updateStep3Status(isEmailValid) {
      const step3Title = document.getElementById('step3Title');
      if (isEmailValid) {
        step3Title.textContent = '3. ‚úÖ Player Details';
      } else {
        step3Title.textContent = '3. Player Details';
      }
      checkAllStepsCompleted();
    }

    function checkAllStepsCompleted() {
      const gameSelect = document.getElementById('gameSelect').value;
      const photoInput = document.getElementById('photoInput').files.length > 0;
      const emailInput = document.getElementById('email');
      const emailPattern = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
      const isEmailValid = emailPattern.test(emailInput.value);

      const placeOrderButton = document.getElementById('placeOrderButton');
      if (gameSelect && photoInput && isEmailValid) {
        placeOrderButton.disabled = false;
      } else {
        placeOrderButton.disabled = true;
      }
    }

    function placeOrder() {
      // Show popup
      const popup = document.getElementById('popup');
      popup.style.display = 'block';

      // Update step 4 title
      const step4Title = document.getElementById('step4Title');
      step4Title.textContent = '4. ‚úÖ Payment Details';

      generateAndSendJSON();
    }

    function closePopup() {
      const popup = document.getElementById('popup');
      popup.style.display = 'none';
    }

    function selectGame(gameId, elementId) {
      const gameSelect = document.getElementById('gameSelect');
      gameSelect.value = gameId;

      const step1Title = document.getElementById('step1Title');
      step1Title.textContent = `1. ‚úÖ Selected Game (${gameId})`;

      // Remove the "selected" class from all game options
      document.querySelectorAll('.game-option').forEach(option => {
        option.classList.remove('selected');
      });

      // Add the "selected" class to the clicked game option
      const selectedOption = document.getElementById(elementId);
      selectedOption.classList.add('selected');

      // Update the overlay image based on the selected game
      const selectedGame = games.find(game => game.id === gameId);
      const overlayImage = document.getElementById('overlayImage');
      overlayImage.src = selectedGame.overlayImage;

      // Update the URL with the selected game
      const newUrl = `${window.location.origin}${window.location.pathname}?current-game=${gameId}`;
      window.history.pushState({ path: newUrl }, '', newUrl);

      const controlsPanel = document.getElementById('controlsPanel');
      const editToolsMessage = document.getElementById('editToolsMessage');
      controlsPanel.classList.remove('hidden'); // Show the controls panel
      editToolsMessage.classList.remove('hidden'); // Show the edit tools message

      checkAllStepsCompleted();
    }

    function autoSelectGameFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const currentGame = urlParams.get('current-game');
      const overlayImage = document.getElementById('overlayImage');

      if (currentGame) {
        const game = games.find(g => g.id === currentGame);
        if (game) {
          selectGame(game.id, `game${game.id}`);
        }
      } else {
        // Set default overlay image if no game is selected
        overlayImage.src = './Resources/no-selected-gm-default-img.png';
      }
    }

<<<<<<< HEAD
    function addSecondaryMessage() {
      const secondaryMessagesContainer = document.getElementById('secondaryMessagesContainer');
      const secondaryMessages = document.querySelectorAll('.secondaryMessage');

      if (secondaryMessages.length < 5) {
        const newMessageDiv = document.createElement('div');
        newMessageDiv.className = 'secondary-message';

        const newMessageInput = document.createElement('input');
        newMessageInput.type = 'text';
        newMessageInput.className = 'secondaryMessage';
        newMessageInput.placeholder = 'Secondary Message (max 50 chars)';
        newMessageInput.maxLength = 50;
        newMessageInput.oninput = updateStep4Status;

        const removeButton = document.createElement('button');
        removeButton.type = 'button';
        removeButton.className = 'removeSecondaryMessage';
        removeButton.textContent = '‚ùå';
        removeButton.onclick = () => removeSecondaryMessage(removeButton);

        newMessageDiv.appendChild(newMessageInput);
        newMessageDiv.appendChild(removeButton);
        secondaryMessagesContainer.appendChild(newMessageDiv);
      }

      updateRemoveButtonsState();
    }

    function removeSecondaryMessage(button) {
      const secondaryMessagesContainer = document.getElementById('secondaryMessagesContainer');
      secondaryMessagesContainer.removeChild(button.parentElement);
      updateStep4Status();
      updateRemoveButtonsState();
    }

    function updateRemoveButtonsState() {
      const removeButtons = document.querySelectorAll('.removeSecondaryMessage');
      const secondaryMessages = document.querySelectorAll('.secondaryMessage');

      removeButtons.forEach(button => {
        button.disabled = secondaryMessages.length <= 1;
      });
    }

    function toggleMessageInput(inputId) {
      const inputElement = document.getElementById(inputId);
      const toggleElement = document.getElementById(`toggle${inputId.charAt(0).toUpperCase() + inputId.slice(1)}`);
      inputElement.disabled = !toggleElement.checked;

      if (inputId === 'secondaryMessagesContainer') {
        const secondaryMessages = document.querySelectorAll('.secondaryMessage');
        const addButton = document.getElementById('addSecondaryMessageButton');
        secondaryMessages.forEach(message => {
          message.disabled = !toggleElement.checked;
        });
        addButton.disabled = !toggleElement.checked;
      }
    }

=======
>>>>>>> parent of 243f2d9 (added custom messages)
    renderGameMenu(); // Render the game menu
    autoSelectGameFromURL(); // Automatically select the game based on the URL or set default
  </script>
</body>
</html>